(()=>{var q=Object.defineProperty,T=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var k=(c,n,i)=>n in c?q(c,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[n]=i,g=(c,n)=>{for(var i in n||(n={}))j.call(n,i)&&k(c,i,n[i]);if(w)for(var i of w(n))x.call(n,i)&&k(c,i,n[i]);return c},D=(c,n)=>T(c,_(n));var p=(c,n,i)=>new Promise((f,d)=>{var h=s=>{try{l(i.next(s))}catch(o){d(o)}},e=s=>{try{l(i.throw(s))}catch(o){d(o)}},l=s=>s.done?f(s.value):Promise.resolve(s.value).then(h,e);l((i=i.apply(c,n)).next())});(function(){let c=$("body");function n(){if(window.location.host!=="ielts.neea.cn"){alert("\u8BF7\u52FF\u5728\u975Eielts.neea.cn\u6FC0\u6D3B\u672C\u9ED1\u79D1\u6280");return}if(document.location.protocol!=="https:"){alert("\u8BF7\u4F7F\u7528ielts.neea.cn\u7684https\u7248\u672C"),window.location.href="https://ielts.neea.cn/login";return}if(window.__hkj){alert("\u8BF7\u52FF\u91CD\u590D\u52A0\u8F7D\u9ED1\u79D1\u6280");return}window.__hkj=!0;let h=window.location.href.match(/myHome\/(\d+)\//);if(!h||h.length<2||!h[1]){alert("\u83B7\u53D6\u62A5\u540DID\u5931\u8D25\uFF0C\u8BF7\u5148\u767B\u5F55\u96C5\u601D\u8003\u8BD5\u62A5\u540D\u7F51\u7AD9"),window.location.href="https://ielts.neea.cn/login";return}i().then().catch(e=>{console.error(e)})}function i(){return p(this,null,function*(){let d=`
        <div id="__hkj_loading" style="
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        height: 100%;
        width: 100%;
        position: fixed;
        background-color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 30px;
        z-index: 1000;
        overflow-x:hidden;
        overflow-y:auto;
        ">
            <h1>Loading...</h1>
        </div>
        `,h=`
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-ui@2.15.13/lib/theme-chalk/index.css">
        <style>
            .rainbow {
                font-family: 'Roboto', sans-serif;
                background: linear-gradient(to right, #6666ff, #0099ff, #00ff00, #ff3399, #6666ff);
                -webkit-background-clip: text;
                color: transparent;
                animation: rainbow_animation 6s ease-in-out infinite;
                background-size: 400% 100%;
            }
            @keyframes rainbow_animation {
                0%, 100% {
                    background-position: 0 0;
                }
    
                50% {
                    background-position: 100% 0;
                }
            }
            .el-loading-spinner .circular{
                display: inline;
            }
            
            #__hkj_app_container{
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
                height: 100%;
                width: 100%;
                position: fixed;
                background-color: #fff;
                z-index: 1001;
                overflow-x:hidden;
                overflow-y:auto;
            }
            
            #__hkj_app{
                padding: 30px;
            }
        </style>
        `;c.css("overflow-y","hidden"),c.append(d),$("head link").remove(),$("head").append(h);let e=["https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js","https://cdn.jsdelivr.net/npm/element-ui@2.15.13/lib/index.min.js"];for(let l of e)yield new Promise((s,o)=>{let a=document.createElement("script");a.src=l,a.onload=t=>{console.log(l+" loaded!"),s()},a.onerror=t=>{o(t)},document.head.append(a)});f()})}function f(){let d=`
        <div id="__hkj_app_container">
            <div id="__hkj_app">
                <h2 class="rainbow text-5xl mb-1">{{ title }}</h2>
                <p class="mb-1"><a href="https://github.com/mydansun/ielts.cn_hkj" target="_blank">https://github.com/mydansun/ielts.cn_hkj</a></p>
                <hr class="my-2">
                <section class="mb-4" v-if="queryCities.length > 0">
                    <el-button type="warning" @click="resetQuery">\u91CD\u7F6E\u9009\u62E9</el-button>
                </section>
                <section class="mb-4">
                    <div class="mb-3">
                        <p class="mb-1">\u8BF7\u9009\u62E9\u8003\u8BD5\u7C7B\u522B</p>
                        <el-select v-model="selectedProductCode" placeholder="\u8BF7\u9009\u62E9" :disabled="typeCityDisabled" style="width: 200px;">
                            <el-option :key="product.value" :value="product.value" v-for="product in products" :label="product.name"></el-option>
                        </el-select>
                    </div>
                    <template v-if="cites.length > 0">
                        <div class="mb-3">
                            <p class="mb-1">\u8BF7\u9009\u62E9\u4E0B\u4E00\u6B65\u67E5\u8BE2\u7684\u8003\u8BD5\u57CE\u5E02\uFF08\u53EF\u591A\u9009\uFF09</p>
                            <el-select v-model="selectedCites" placeholder="\u8BF7\u9009\u62E9" multiple filterable :disabled="typeCityDisabled" style="width: 400px;">
                                <el-option :key="city.value" :value="city" v-for="city in cites" :label="city.name">
                                </el-option>
                            </el-select>
                        </div>
                        <el-button type="primary" @click="updateCities" v-if="!typeCityDisabled">
                            \u4E0B\u4E00\u6B65
                        </el-button>
                    </template>
                    <hr class="my-2">
                </section>
                <section class="mb-4" v-if="queryCities.length > 0">
                    <div class="mb-3">
                        <p class="mb-1">\u4E0B\u9762\u662F\u4F60\u9009\u62E9\u7684\u57CE\u5E02</p>
                        <ul class="list-disc list-inside">
                            <li v-for="queryCity in queryCities" :key="queryCity.value">
                                {{ queryCity.name }}
                                <code>{{ queryCity.value }}</code>
                            </li>
                        </ul>
                    </div>
                    <div class="mb-3" v-if="availableDates.length > 0">
                        <p class="mb-1">\u6839\u636E\u4F60\u9009\u62E9\u7684\u57CE\u5E02\uFF0C\u53EF\u7528\u7684\u8003\u8BD5\u65E5\u671F\u5982\u4E0B\uFF0C\u8BF7\u9009\u62E9\u8981\u67E5\u8BE2\u65E5\u671F\uFF08\u53EF\u591A\u9009\uFF09</p>
                        <el-select v-model="selectedDates" placeholder="\u8BF7\u9009\u62E9" multiple filterable :disabled="dateDisabled" style="width: 400px;">
                            <el-option :value="availableDate" v-for="availableDate in availableDates" :key="availableDate" :label="availableDate">
                            </el-option>
                        </el-select>
                    </div>
                    <el-button type="primary" @click="updateDates" v-if="!dateDisabled">
                        \u4E0B\u4E00\u6B65       
                    </el-button>
                    <hr class="my-2">
                </section>
                <section class="mb-4" v-if="queryDates.length > 0">
                    <div class="mb-3">
                        <p class="mb-1">\u4E0B\u9762\u662F\u4F60\u9009\u62E9\u7684\u65E5\u671F</p>
                        <ul class="list-disc list-inside">
                            <li v-for="queryDate in queryDates" :key="queryDate">
                                {{ queryDate }}
                            </li>
                        </ul>
                    </div>
                    <div class="mb-3">
                        <p class="mb-1">
                            \u4E0B\u9762\u662F\u67E5\u8BE2\u5230\u7684\u53EF\u4EE5\u62A5\u8003\u7684\u8003\u4F4D
                            <span class="rainbow">
                                \uFF08<strong v-if="lastUpdated">\u66F4\u65B0\u4E8E {{ lastUpdated }}</strong> | \u6BCF\u9694 {{ refreshInterval / 1000 }} \u79D2\u81EA\u52A8\u5237\u65B0\u4E2D...\uFF09
                            </span>
                        </p>
                        <el-table :data="tests" border stripe style="width: 100%" row-key="seatId">
                            <el-table-column
                                sortable
                                prop="cityName"
                                label="\u57CE\u5E02">
                            </el-table-column>
                            
                            <el-table-column
                                sortable
                                prop="testDay"
                                label="\u65E5\u671F">
                            </el-table-column>
                            
                            <el-table-column
                                sortable
                                prop="testTime"
                                label="\u65F6\u95F4">
                            </el-table-column>
                            
                            <el-table-column
                                sortable
                                prop="centerName"
                                label="\u8003\u70B9">
                            </el-table-column>
                            
                            <el-table-column
                                sortable
                                prop="levelCode"
                                label="\u8003\u8BD5\u7EA7\u522B">
                            </el-table-column>
                               
                            <el-table-column
                                sortable
                                prop="writtenType"
                                label="\u8003\u8BD5\u7C7B\u578B">
                            </el-table-column>
                            
                            <el-table-column
                                sortable
                                prop="speakType"
                                label="\u53E3\u8BD5\u7C7B\u578B">
                            </el-table-column>
                        </el-table>
                    </div>
                </section>
            </div>
        </div>
        `;c.append(d),new Vue({el:"#__hkj_app",data:function(){return{title:"\u96C5\u601D\u9ED1\u79D1\u6280",selectedProductCode:"",queryProductCode:"",products:[{value:"IELTSPBT",name:"\u666E\u901A\u8003\u8BD5"},{value:"IELTSUKVIPBT",name:"\u7528\u4E8E\u7B7E\u8BC1"}],cites:[],selectedCites:[],queryCities:[],availableDates:[],selectedDates:[],queryDates:[],tests:[],csrfToken:$("meta[name='_csrf']").attr("content"),sessionHandle:null,refreshHandle:null,loading:null,refreshInterval:30*1e3,lastUpdated:""}},computed:{typeCityDisabled(){return this.queryCities.length>0},dateDisabled(){return this.queryDates.length>0}},mounted(){this.sessionHandle=setInterval(()=>{this.refreshToken()},30*1e3)},methods:{initLoading(){this.loading=this.$loading({target:"#__hkj_app"})},closeLoading(){this.loading&&(this.loading.close(),this.loading=null)},resetQuery(){this.initLoading(),this.cleanRefreshHandle(),this.tests=[],this.queryDates=[],this.selectedDates=[],this.availableDates=[],this.queryCities=[],this.selectedCites=[],this.cites=[],this.queryProductCode="",this.selectedProductCode="",this.closeLoading()},cleanRefreshHandle(){this.refreshHandle&&(clearTimeout(this.refreshHandle),this.refreshHandle=null)},sleep(e){return p(this,null,function*(){return new Promise(l=>{setTimeout(()=>{l()},e)})})},refreshToken(){$.ajax({type:"GET",url:"homepage",success:e=>{let s=$(e).find("meta[name='_csrf']").attr("content");s&&s!==this.csrfToken&&(this.csrfToken=s,console.log("csrfToken changed to %s",this.csrfToken))}})},updateCities(){return p(this,null,function*(){this.initLoading(),this.queryProductCode=this.selectedProductCode,this.queryCities.splice(0),this.availableDates.splice(0),this.queryCities=this.selectedCites.slice();let e=[];for(let{name:l,value:s}of this.queryCities){let o=yield new Promise(t=>{$.getJSON("getTestDate",{productCode:this.queryProductCode,cityCode:s},u=>{t(u)})}),a=Object.keys(o);console.log("%s\u6709%d\u4E2A\u53EF\u7528\u65E5\u671F.",l,a.length);for(let t of a)e.includes(t)||e.push(t);yield this.sleep(100)}e.sort(),this.availableDates=e,this.closeLoading()})},updateDates(){return p(this,null,function*(){this.initLoading(),this.cleanRefreshHandle(),this.queryDates=this.selectedDates.slice();let e=yield this.fetchSeats();console.log("%d\u4E2A\u57CE\u5E02\u603B\u5171\u67E5\u8BE2\u5230%d\u4E2A\u8003\u4F4D",this.queryCities.length,e.length,e),this.tests=e,this.refreshHandle=setTimeout(()=>{this.continuesUpdate()},this.refreshInterval),this.closeLoading()})},continuesUpdate(){return p(this,null,function*(){let e=yield this.fetchSeats();this.tests=e,console.log("\u5DF2\u66F4\u65B0\uFF0C%d\u4E2A\u57CE\u5E02\u603B\u5171\u67E5\u8BE2\u5230%d\u4E2A\u8003\u4F4D",this.queryCities.length,e.length,e),this.refreshHandle&&(this.refreshHandle=setTimeout(()=>{this.continuesUpdate()},this.refreshInterval))})},fetchSeats(){return p(this,null,function*(){let e=[];this.lastUpdated=new Date().toLocaleString();for(let{name:l,value:s}of this.queryCities)for(let o of this.queryDates){let a=new URLSearchParams;a.append("productCode",this.queryProductCode),a.append("queryCity",s),a.append("queryTestDate",o),a.append("queryActionType","Order.QueryOrder"),a.append("neeaAppId","");let t=yield new Promise(y=>{$.ajax({type:"POST",headers:{"X-CSRF-TOKEN":this.csrfToken},dataType:"json",url:"queryTestSeats",data:a.toString(),success:b=>{y(b)}})});!t||!(t!=null&&t.testDay)?console.log("%s\u5728%s\u6CA1\u6709\u8003\u4F4D\u4FE1\u606F",l,o):console.log("%s\u5728%s\u6709\u8003\u4F4D\u4FE1\u606F",l,o,t);let u={cityCode:t.cityCode,cityName:t.cityName,testDay:t.testDay,changeDeadline:t.rescheduleAndCancelDeadline},m=t==null?void 0:t.testSeats,C=0;if(m&&m.length>0)for(let y of m){let b={testTime:y.testTime},v=y==null?void 0:y.testSeat;if(v&&v.length>0)for(let r of v)r.seatStatus===1&&r.optStatus===1&&(C+=1,e.push(D(g(g({},u),b),{seatId:r.seatId,centerCode:r.centerCode,centerName:r.centerName,levelCode:r.levelCode,writtenType:r.writtenType,speakType:r.speakType})))}console.log("%s\u5728%s\u6709%d\u4E2A\u8003\u4F4D",l,o,C),yield this.sleep(100)}return e})}},watch:{selectedProductCode(e,l){e&&(console.log("Change product from %s to %s",l,e),this.initLoading(),this.cites.splice(0),this.selectedCites.splice(0),e&&$.getJSON("getTestCenterProvinceCity",{productCode:e},s=>{let o=[];for(let a of s){let t=a.cities;for(let u of t)o.push({name:a.provinceNameCn+" - "+u.cityNameCn,value:u.cityCode})}console.log("cities updated",o),this.cites=o,this.closeLoading()}))}}})}n()})();})();
